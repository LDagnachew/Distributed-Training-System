syntax = "proto3";

package orchestrator;

service OrchestratorService {
	rpc SendCommand(GetOrchestratorCommand) returns (OrchestratorCommand);
}

message GetOrchestratorCommand {
	// Empty - for now
}

import "google/protobuf/timestamp.proto";

message OrchestratorCommand {
	// book keeping
	uint64 command_id = 1;
	google.protobuf.Timestamp issued_at = 2;
	oneof command_type {
		StartTraining start_training = 3;
		BeginCheckpoint begin_checkpoint = 4;
		RestoreCheckpoint restore_checkpoint = 5;
		ResumeTraining resume_training = 6;
		AbortCheckpoint abort_checkpoint = 7;
		Shutdown shutdown = 8;
		NoOp no_op = 9;
	}
}

message StartTraining {
	uint64 worker_id = 1;
	uint64 world_size = 2;
	string model = 3;
	double learning_rate = 4;
	uint64 batch_size = 5;
	uint64 epochs = 6;
	uint64 seed = 7;
}

message BeginCheckpoint {
	uint64 command_id = 1;
	string checkpoint_id = 2;
	uint64 target_step = 3;
}

message RestoreCheckpoint {
	string command_id = 1;
	string checkpoint_id = 2;
	string path_to_checkpoint = 3;
}

message ResumeTraining {
	string command_id = 1;
	string from_step = 2;
}

message AbortCheckpoint {
	string command_id = 1;
	optional string reason = 2;
}

message Shutdown {
	optional string reason = 1;
}

message NoOp {
	// keep empty lmfao
}